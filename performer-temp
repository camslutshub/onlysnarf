
# Downloads random performer from Google Drive
def get_random_performer():
    print('Downloading Random Performer')
    random_folders = drive.ListFile({'q': "'"+OnlyFans_PERFORMERS_FOLDER+"' in parents and trashed=false and mimeType contains 'application/vnd.google-apps.folder'"}).GetList()
    performer_list = [];
    random_performer = None;
    # print('random folders: '+str(random_folders))
    for folder in random_folders:
        random_folder_folder = random.choice(random_folders)
        maybePrint('random performer: '+random_folder_folder['title'])
        performer_content_list = drive.ListFile({'q': "'"+random_folder_folder['id']+"' in parents and trashed=false and mimeType contains 'application/vnd.google-apps.folder'"}).GetList()
        # print('random folders: '+str(performer_list))
        if len(performer_content_list)==0:
            maybePrint('- skipping empty performer: '+random_folder_folder['title'])
        elif len(performer_content_list)>0:
            maybePrint('- performer found: '+random_folder_folder['title'])
            global PERFORMER_NAME
            PERFORMER_NAME = random_folder_folder['title']
            random_performer = random.choice(performer_list)
            maybePrint('random performer: '+random_performer['title'])
            return random_performer
    if len(performer_list)==0:
        print('No performer folder found!')
        sys.stdout.flush()
        return sys.exit(0)
    random_performer = random.choice(performer_list)
    print('Random Performer: '+random_performer['title'])
    return random_performer


def download_performer(folder):
    print('Downloading Performer content...')
    # mkdir /tmp
    path = os.getcwd()
    path += '/tmp'+"/"+str(folder['title'])
    maybePrint('path: '+path)
    if not os.path.exists(path):
        os.makedirs(path)

    random_folders = drive.ListFile({'q': "'"+folder['id']+"' in parents and trashed=false and mimeType contains 'application/vnd.google-apps.folder'"}).GetList()
    content_list = [];
    random_content = None;
    # print('random folders: '+str(random_folders))
    for folder in random_folders:
        random_folder_folder = random.choice(random_folders)
        maybePrint('random content: '+random_folder_folder['title'])
        content_list = drive.ListFile({'q': "'"+random_folder_folder['id']+"' in parents and trashed=false and mimeType contains 'application/vnd.google-apps.folder'"}).GetList()
        # print('random folders: '+str(content_list))
        if len(content_list)==0:
            maybePrint('- skipping empty content: '+random_folder_folder['title'])
        elif len(content_list)>0:
            maybePrint('- content found: '+random_folder_folder['title'])
            global FOLDER_NAME
            FOLDER_NAME = random_folder_folder['title']
            random_content = random.choice(content_list)
            maybePrint('random content: '+random_content['title'])
            return random_content
    if len(content_list)==0:
        print('No content folder found!')
        sys.stdout.flush()
        return sys.exit(0)
    random_content = random.choice(content_list)

    # download folder
    file_list = drive.ListFile({'q': "'"+folder['id']+"' in parents and trashed=false and mimeType contains 'image/jpeg'"}).GetList()
    folder_size = len(file_list)
    maybePrint('Folder size: '+str(folder_size))
    maybePrint('Upload limit: '+str(IMAGE_UPLOAD_LIMIT))
    file_list_random = []
    for x in range(IMAGE_UPLOAD_LIMIT):
        random_file = random.choice(file_list)
        file_list.remove(random_file)
        file_list_random.append(random_file)
    i = 1
    for file in sorted(file_list_random, key = lambda x: x['title']):
        print('Downloading {} from GDrive ({}/{})'.format(file['title'], i, folder_size))
        maybePrint('filePath: '+path+"/"+str(file['title']))
        file.GetContentFile(path+"/"+str(file['title']))
        i+=1
    print('Download Complete')
    return path


def upload_performer_to_OnlyFans(dirName, path):
    global FOLDER_NAME
    if HASHTAGGING:
        postText = str(dirName)+" #"+" #".join(FOLDER_NAME.split(' '))
    else:    
        postText = str(FOLDER_NAME)+" "+str(dirName)
    print('Uploading: '+postText)
    maybePrint('path: '+path)
    files_path = []
    for file in pathlib.Path(path).iterdir():  
        files_path.append(str(file))
    maybePrint('files: '+str(files_path))
    global BROWSER
    BROWSER.find_element_by_id("new_post_text_input").send_keys(postText)
    for file in files_path:
        maybePrint('uploading: '+str(file))
        BROWSER.find_element_by_id("fileupload_photo").send_keys(file)
        WebDriverWait(BROWSER, 600).until(EC.element_to_be_clickable((By.XPATH, '//button[@type="submit" and @class="btn btn-xs btn-default send_post_button"]')))
    if DEBUG:
        print('skipping OnlyFans upload')
        return
    send = WebDriverWait(BROWSER, 600).until(EC.element_to_be_clickable((By.XPATH, '//button[@type="submit" and @class="btn btn-xs btn-default send_post_button"]'))).click()
    print('Directory Uploaded Successfully')
    return
